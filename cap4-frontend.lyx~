#LyX 2.3 created this file. For more info see http://www.lyx.org/
\lyxformat 544
\begin_document
\begin_header
\save_transient_properties true
\origin unavailable
\textclass book
\begin_preamble

\end_preamble
\use_default_options true
\master maestro-pfg.lyx
\maintain_unincluded_children false
\language spanish
\language_package default
\inputencoding utf8
\fontencoding global
\font_roman "default" "default"
\font_sans "default" "default"
\font_typewriter "default" "default"
\font_math "auto" "auto"
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100 100
\font_tt_scale 100 100
\use_microtype false
\use_dash_ligatures true
\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\paperfontsize default
\spacing single
\use_hyperref false
\papersize default
\use_geometry true
\use_package amsmath 1
\use_package amssymb 1
\use_package cancel 1
\use_package esint 1
\use_package mathdots 1
\use_package mathtools 1
\use_package mhchem 1
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine basic
\cite_engine_type default
\biblio_style plain
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 0
\use_minted 0
\index Índice
\shortcut idx
\color #008000
\end_index
\leftmargin 2.5cm
\topmargin 2cm
\rightmargin 2cm
\bottommargin 2cm
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\is_math_indent 0
\math_numbering_side default
\quotes_style english
\dynamic_quotes 0
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Chapter
Módulo 'pfg-frontend'
\end_layout

\begin_layout Standard
En este capítulo se profundizará más en el módulo dedicado a la interfaz
 web con el cliente.
 En primer lugar, se comenzará por una introducción argumentando el porqué
 de este módulo y la elección de las tecnologías empleadas, a continuación
 se hará un recorrido mostrando la interfaz y las posibilidades que ofrece
 no solo este módulo, sino el conjunto del sistema, pero a través de la
 interfaz.
 Por último se hará una breve descripción a más bajo nivel de cómo está
 organizado el módulo a nivel de código.
\end_layout

\begin_layout Section
Introducción
\end_layout

\begin_layout Standard
La elaboración de una interfaz web ha supuesto para mí un reto inesperado.
 Pese a que en un primer momento el planteamiento original pasaba por crear
 una interfaz gráfica pensando en un usuario final, no era de esperar más
 que un formulario sencillo y algunos botones.
 Sin embargo, a medida que el proyecto ha ido madurando, es una necesidad
 que ha surgido.
 Por una parte, al pretender crear un servicio distribuido y accesible desde
 diferentes dispositivos, y por otra al tener experiencias negativas trabajando
 con JavaRMI y directamente con sockets, la interfaz web se presentó como
 una opción asequible y multiplataforma.
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset

Cabe mencionar que no tenía ninguna experiencia previa con tecnologías web,
 así que como primer paso me puse a aprender desde el principio.
 HTML, CSS, y javascript.
 Estos conocimientos básicos, junto con jQuery
\begin_inset Foot
status open

\begin_layout Plain Layout
Librería de JavaScript 
\end_layout

\end_inset

 y AJAX
\begin_inset Foot
status open

\begin_layout Plain Layout
Ajax es un acrónimo de Asynchronous JavaScript and XML.
 La idea esencial es hacer una petición a un servidor sin tener que renderizar
 la página HTML al completo 
\begin_inset CommandInset citation
LatexCommand cite
key "castillo2017curso"
literal "false"

\end_inset


\end_layout

\end_inset

, me sirvieron para hacer un primer modelo sencillo e integrarlo con el
 backend.
 No era gran cosa pero me permitía crear un formulario con una serie de
 campos y crear un objeto a partir de ellos para enviar al servidor.
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset

Cualquiera que haya programado alguna vez una página web sabrá que hacer
 cualquier cosa y que el resultado sea 
\begin_inset Quotes eld
\end_inset

más o menos
\begin_inset Quotes erd
\end_inset

 estético no es algo trivial, pero eso para mí era otro punto con el que
 no contaba.
 Pese a que no era una cuestión prioritaria en este proyecto, me había surgido
 cierto interés en el tema teniendo curiosidad por cómo se harían estos
 desarrollos a nivel profesional, ya que a mí hacer un simple formulario
 ya me había llevado una cantidad de tiempo importante.
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset

De esta manera descubrí en primer lugar 
\series bold
Thymeleaf
\series default
.
 Se trata de un motor de plantillas Java (
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "JSP"
description "Java Server Pages"
literal "true"

\end_inset

JSP
\begin_inset Foot
status open

\begin_layout Plain Layout
Java Server Pages
\end_layout

\end_inset

) para entornos web e independientes.
 El objetivo principal de thymeleaf es incorporar plantillas a su flujo
 de trabajo de desarrollo, HTML, que se puede mostrar correctamente en los
 navegadores web y también funcionan como prototipos estáticos, lo que permite
 una colaboración más sólida en los equipos de desarrollo 
\begin_inset CommandInset citation
LatexCommand cite
key "webb2013spring"
literal "false"

\end_inset

.
 Las razones por las que escogí esta tecnología fueron:
\end_layout

\begin_layout Itemize
Sencillez de uso, similar a HTML nativo y me permitía emplear java en lugar
 de javascript para varias acciones
\end_layout

\begin_layout Itemize
Prescindir de la lógica necesaria para las peticiones HTTP al poder utilizar
 plantillas
\end_layout

\begin_layout Itemize
Integración con Spring, empleado en 
\begin_inset Quotes eld
\end_inset

pfg-backend
\begin_inset Quotes erd
\end_inset

 
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement h
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename figs/4-frontend/thymeleaf-logo.png
	width 40text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Logo de Thymeleaf.
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
Durante un tiempo mantuve las plantillas de thymeleaf como frontend del
 servicio, pero en vista de que la interfaz iba creciendo en funcionalidades
 y extensión, el código fuente se iba haciendo cada vez menos mantenible
 debido entre otras cosas al poco grado de reutilización entre plantillas.
 Por poner un ejemplo, cuando surgió la necesidad de crear una barra lateral
 para facilitar la navegación, cada vez que se modificaba dicha barra, ya
 sea añadir un nuevo elemento, cambiar un nombre, cambiar un estilo, no
 quedaba otra que copiar ese cambio en todas las plantillas que tuvieran
 la barra de navegación, a pesar de ser un componente común a todas ellas.
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset

Buscando una solución alternativa (que había evitado anteriormente por el
 coste del aprendizaje) me encuentro con la decisión de elegir una de entre
 las tres tecnologías dominantes en la actualidad en cuanto a la programación
 web frontend: 
\series bold
Angular
\series default
, 
\series bold
React
\series default
 o 
\series bold
Vue
\series default
.
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Float figure
placement h
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename figs/4-frontend/angular-react-vue.png
	width 100text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Logos de Angular, React y Vue.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Tres frameworks de javascript ampliamente utilizados en el desarrollo de
 interfaces web.
 De acuerdo con diversos análisis y estadísticas de uso, no parece haber
 un claro vencedor ni en rendimiento ni en dominio del mercado, cada uno
 de ellos tiene sus puntos fuertes y débiles y las fluctuaciones en el tiempo
 hacen que ninguno de ellos se establezca como ganador.
 En este caso, la decisión ha sido optar por 
\series bold
Angular
\series default
.
 Se puede encontrar algo más de información sobre este framework en 
\begin_inset CommandInset ref
LatexCommand vref
reference "sec:AngularJS"
plural "false"
caps "false"
noprefix "false"

\end_inset


\begin_inset Newline newline
\end_inset


\end_layout

\begin_layout Section
Recorrido por la interfaz
\end_layout

\begin_layout Standard
En primer lugar, es importante mencionar que esta interfaz está desarrollada
 a partir de una plantilla 
\emph on
open-source
\emph default
 llamada 
\begin_inset Quotes eld
\end_inset

ngx-admin
\begin_inset Quotes erd
\end_inset

, creada por Akveo.
 Akveo es un grupo compuesto por desarrolladores, especialistas de marketing
 y diseñadores que proporcionan algunos de sus productos de manera gratuita
 como en este caso, o a la venta, e incluso su servicio para adaptar dichas
 plantillas o crear nuevos diseños desde cero.
 Esta plantilla en concreto está basada en Angular 9+, Nebular y Eva Design
 System.
 Tanto Nebular como Eva Design son otros dos proyectos de Akveo, dos librerías
 
\emph on
open-source 
\emph default
que proporcionan componentes Angular, estilos, iconos y más.
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset

A continuación se va a hacer un recorrido por la interfaz web desde el punto
 de vista de un usuario.
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset

Comenzando por el principio, al ingresar la url del servicio, este redirecciona
 al usuario a su página de login en '/auth/login':
\begin_inset Newline newline
\end_inset


\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename figs/4-frontend/login.png
	width 100text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Página de login
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
Dado que este proyecto se encuentra en fase de desarrollo se generan una
 serie de usuarios preconfigurados en base de datos con diferentes roles
 para agilizar el testeo.
 Estos usuarios se pueden encontrar en el 
\begin_inset Quotes eld
\end_inset

readme.md
\begin_inset Quotes erd
\end_inset

 del proyecto en el repositorio Git.
 Al contar ya con un usuario se van a omitir los casos de uso de registro
 y recuperar contraseña, ya que no son el objetivo principal de esta memoria.
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset

Esta página de login cuenta con un campo para introducir el email y otro
 para la contraseña.
 Una vez introducidos y pulsado el boton 
\begin_inset Quotes eld
\end_inset

LOG IN
\begin_inset Quotes erd
\end_inset

, se envía una petición POST vía HTTP al servicio REST expuesto por el backend
 en el endpoint '/api/auth/login'.
 En adelante, por abreviar, me referiré a procesos de este tipo como 
\begin_inset Quotes eld
\end_inset

enviar un POST a '/api/auth/login'
\begin_inset Quotes erd
\end_inset

.
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset

El cuerpo de este mensaje será un JSON que contenga email y password.
 En caso de introducir las credenciales correctas, el servidor devolverá
 un código 200 (OK) acompañado de un token JWT que contiene la información
 del usuario básica que necesita la interfaz.
 La interfaz interpretará esto como login exitoso, notificará al usuario
 con un 
\emph on
pop-up
\emph default
 y tras un pequeño 
\emph on
delay
\emph default
 (establecido en 500 ms), lo redireccionará a la página principal.
 Una vez autorizado, todas las peticiones siguientes contarán con dicho
 token en la cabecera hasta su caducidad.
 Por defecto, la vida útil de este token está fijada por el backend a 15
 minutos.
 En el momento en el que el token caduque, la próxima petición realizada
 por la interfaz con ese token en la cabecera fallará y redireccionará al
 usuario de nuevo a la página de login.
 De esta manera, cada vez que el usuaro navegue por la web o haga peticiones
 contra el servidor, siempre se tendrá presente la identidad del usuario
 en la cabecera de las peticiones, lo que permite identificar quién las
 realiza, por ejemplo para poder obtener el rol y mostrar o no mostrar contenido
 de acuerdo con sus privilegios, o al solicitar una acción como puede ser
 componer una partitura, saber a qué usuario asignársela.
 
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset

Una vez autenticado, el usuario debería encontrarse en la página de inicio
 ubicada en '/pages/home'.
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Labeling
\labelwidthstring 00.00.0000
\begin_inset Graphics
	filename figs/4-frontend/home.png
	width 100text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Sección home
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
Como se mencionaba anteriormente, el diseño de esta interfaz se corresponde
 con la plantilla 'ngx-admin', adaptándola a las necesidades de este proyecto.
 A grandes rasgos se pueden distinguir tres componentes principales:
\end_layout

\begin_layout Itemize

\bar under
Cabecera
\bar default
: Una franja en la parte superior de la interfaz, que de izquierda a derecha
 contiene un botón para colapsar y expandir el menú de navegación, el nombre
 de la aplicación, información sobre la versión y un desplegable con la
 identificación del usuario que permite realizar acciones sobre él.
\end_layout

\begin_layout Itemize

\bar under
Menú de navegación
\bar default
: Barra lateral vertical en la parte izquierda.
 Permite navegar por la interfaz redirigiendo al usuario a las diferentes
 
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "URLs"
description "Uniform Resource Locator"
literal "false"

\end_inset

URLs correspondientes a cada sección.
 
\end_layout

\begin_layout Itemize

\bar under
Panel central
\bar default
: Área situada en el centro de la pantalla en la que se muestra el contenido
 de cada sección.
\end_layout

\begin_layout Standard
La sección 
\series bold
'Home'
\series default
 es la principal.
 A la que se redirige al usuario tras el login.
 En ella se encuentra una descripción breve del proyecto junto con un 
\emph on
changelog
\emph default
, un listado que recopila información sobre las últimas versiones y sus
 cambios.
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset

Haciendo uso de la cabecera, haciendo click en el usuario actual, se puede
 acceder a las siguientes acciones anteriormente mencionadas:
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename figs/4-frontend/user-dropdown.png
	width 40text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Desplegable acciones de usuario
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
Seleccionando la opción 
\series bold
'Log out'
\series default
, redirecciona al usuario a la ruta '/auth/login', permitiéndole al usuario
 invalidar el token de acceso a la aplicación, lo que provoca la redirección
 de este de nuevo a la pantalla de login.
 De esta manera se permite iniciar sesión con otro usuario distinto o simplement
e cerrar la sesión actual.
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset

En cuanto a 
\series bold
'Profile'
\series default
, redirige al usuario a la sección '/pages/profile':
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename figs/4-frontend/user.png
	width 100text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Sección profile
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
En la sección profile el usuario podrá ver sus datos de usuario, así como
 generar un token JWT asociado a su cuenta.
 Por el momento este token no tiene ninguna finalidad para el usuario, simplemen
te se ha incluído esta funcionalidad para agilizar el desarrollo.
 Este token es empleado al hacer llamadas a métodos seguros del API para
 evitar introducir usuario y contraseña en claro.
 Poder extraer el token a través de la interfaz permite al desarrollador
 introducirlo manualmente en apliaciones como 'Postman' para testear APIs.
 El desplegable permite elegir la duración de este token.
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset

Una posible funcionalidad futura podría ser, por ejemplo, que un usuario
 quisiera autorizar a una aplicación de terceros a utilizar este servicio
 en su nombre.
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset

Continuando con el recorrido y pasando al menú de navegación se encuentra
 la sección de 
\series bold
'Composición'
\series default
.
 Esta entrada en el menú es un desplegable, que dentro contiene otras dos
 entradas: 
\series bold
'Genético'
\series default
 y 
\series bold
'Red neuronal'
\series default
, haciendo referencia al tipo de algoritmo empleado para la composición.
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename figs/4-frontend/composicion-genetico.png
	width 100text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Sección composición algoritmo genético
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
El caso de uso del que trata este proyecto es la implementación del algoritmo
 genético y por tanto se va a omitir la otra opción, ya que corresponde
 a pruebas de implementaciones alternativas que todavía no está disponible.
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset

La sección de composición utilizando el algoritmo genético consiste en un
 formulario muy simple, en el que se puede indicar una serie de características
 de la obra resultante.
 Es obligatorio cubrir todos los campos antes de pulsar el botón componer.
 De lo contrario, la fase de validación previa fallará y aparecerá un mensaje
 de error indicando el problema.
 A la derecha del botón componer hay otro botón con unas flechas que sirve
 para cubrir este formulario de manera aleatoria (incluso el título).
 Muy útil para testeo.
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset

Al cubrir correctamente el formulario y pulsar el botón componer, la validación
 a nivel de frontend debería ser exitosa y se enviará un 'POST' al API incluyend
o estas especificaciones en el cuerpo del mensaje.
 El API recibirá estas especificaciones y creará una entrada en la tabla
 'sheets' de la base de datos con campos como un id autogenerado, título,
 fecha de creación, etc.
 A continuación generará un archivo JSON conteniendo estas especificaciones
 y las guardará en el sistema de ficheros de la aplicación para poder reintentar
 la operación en caso de que la fase posterior de composición falle.
 Una vez hecho esto, se enviará ese mismo archivo JSON a la cola correspondiente
 de Kafka, a la espera de que uno de los consumidores disponibles lea el
 archivo y lo procese.
 Una vez hecho esto, la tarea del API habrá terminado, y será el consumidor
 el que continúe con la ejecución.
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset

Dicho consumidor será una instancia del módulo pfg-composer-genetic.
 Para ilustrar mejor el porqué de esta estructura pongamos el ejemplo de
 que la funcionalidad de la composición empleando una red neuronal estuviera
 implementada.
 En ese caso, podría haber otro tipo de consumidores para resolver este
 problema suscritos a Kafka.
 Las especificaciones, dependiendo de qué algoritmo empleen, se publicarán
 en una cola u en otra pero con el mismo formato, un archivo JSON.
 De esta manera los dos tipos de consumidores pueden trabajar de manera
 independiente, estar escritos en lenguajes distintos, y sobre todo escalar
 de manera independiente.
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset

Volviendo al caso del consumidor que aplica al ejemplo, al detectar que
 se ha añadido una nueva tarea a su cola entrará en ejecución tan pronto
 como sea posible.
 Con esa información ejecutará el algoritmo (se entrará más en detalle en
 el capítulo correspondiente a este módulo, 
\begin_inset CommandInset ref
LatexCommand ref
reference "chap:Módulo-'pfg-composer'"
plural "false"
caps "false"
noprefix "false"

\end_inset

) y una vez tenga los archivos resultantes (
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "PDF"
description "Portable Document Format"
literal "false"

\end_inset

PDF y MusicXML) enviará peticiones al API incluyendo estos archivos para
 que los guarde en su sistema de ficheros y marque la composición como terminada.
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset

Todo este proceso se realiza de forma transparente al usuario y no bloqueante.
 El usuario únicamente recibe una notificación push confirmando que la petición
 se ha enviado al servidor, e inmediatamente después puede seguir navegando
 por la web.
 No recibirá notificación cuando la composición haya terminado, pero puede
 ver su estado en la sección 'Mi repositorio'.
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset

La sección '
\series bold
Mi repositorio
\series default
' es el lugar en el que el usuario puede ver sus composiciones terminadas
 o en curso.
 En resumen, todas las entradas de la tabla 'sheets' de la base de datos
 asociadas a este usuario.
 Puede que haya inconsistencias entre la tabla y el sistema de ficheros,
 como por ejemplo que una partitura no exista, haya habido algún error durante
 la composición, pero el usuario cuenta con mecanismos para reintentar o
 borrar estas entradas.
 Se puede acceder a esta sección a través del menú de navegación haciendo
 click en la entrada 'Mi repositorio':
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename figs/4-frontend/repositorio.png
	width 100text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Sección-Mi-repositorio"

\end_inset

Sección Mi repositorio
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
En la imagen se puede ver el aspecto de esta sección.
 Contiene la tabla mencionada con un campo de búsqueda que filtra en cada
 pulsación entre los registros mostrados en dicha tabla.
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset

La imagen representa los tres estados posibles de una partitura:
\end_layout

\begin_layout Itemize
Test 1: La composición de la obra se ha llevado a cabo correctamente y está
 disponible para su visualización, descarga o borrado.
\end_layout

\begin_layout Itemize
Test 2: La composición de la obra está todavía en proceso.
 La diferencia visual con la siguiente fila que no se puede apreciar en
 esta captura es que el icono de las flechas en círculo está en movimiento
 indicando que se encuentra en ejecución en un compositor.
 Como se puede comprobar, la acción de visualizar está deshabilitada al
 no estar disponible la partitura.
 El de descarga sigue pareciendo habilitado, esto es porque ese botón no
 descarga directamente la partitura, sino que abre un diálogo para elegir
 el formato deseado, en el cual ambas opciones estarán deshabilitadas.
\end_layout

\begin_layout Itemize
Test 3: La composición de la obra se ha marcado como finalizada, sin embargo
 el archivo no se encuentra en el sistema de ficheros.
 Esto puede deberse a múltiples motivos, ha surgido una excepción no controlada
 en el compositor, se ha borrado posteriormente, el volumen docker no ha
 sido enlazado correctamente al desplegar...
 En cualquier caso, esta partitura no podrá ser visualizada ni descargada
 y se habilitará un botón para reintentar la operación.
 En caso de que las especificaciones sí se encuentren disponibles en el
 sistema de ficheros, se procederá a repetir el proceso.
 Por último, si no es el caso ni existe posibilidad de recuperar la partitura,
 se puede eliminar el registro de la base de datos.
\end_layout

\begin_layout Standard
Ya se han introducido las opciones que se pueden realizar en cada registro,
 veamos más en detalle qué sucede en cada una de ellas:
\end_layout

\begin_layout Itemize

\bar under
Visualizar
\bar default
: Abre el archivo PDF generado durante la fase de composición en una pestaña
 nueva del navegador.
\end_layout

\begin_layout Itemize

\bar under
Descargar
\bar default
: Abre una ventana de diálogo para elegir en qué formato se desea descargar
 el archivo.
 Las opciones disponibles por el momento son PDF y MusicXML.
 En caso de que uno de estos archivos no esté disponible, aparecerá la opción
 deshabilitada y el usuario no podrá hacer click en ella.
 Si el archivo está disponible, se descargará en el equipo.
\begin_inset Newline newline
\end_inset


\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename figs/4-frontend/dialogo-descarga.png
	width 40text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Diálogo descargar partitura con opciones deshabilitadas
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Itemize

\bar under
Eliminar
\bar default
: Elimina del sistema de ficheros los archivos relacionados con la composición
 seleccionada y elimina el registro de la tabla 'sheets' de la base de datos.
\end_layout

\begin_layout Itemize

\bar under
Reintentar
\bar default
 (sólo cuando faltan archivos): En caso de que falte el pdf pero el archivo
 xml sí exista, se añade a la cola del compositor una nueva tarea de conversión
 de la partitura en xml.
 Si faltan ambos archivos, a partir de las especificaciones introducidas
 inicialmente se solicita una nueva composición.
 En caso de que no se encuentre tampoco el archivo con las especificaciones
 introducidas, se notifica el error y no será posible reintentar.
\end_layout

\begin_layout Standard
Aprovechando la imagen 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Sección-Mi-repositorio"
plural "false"
caps "false"
noprefix "false"

\end_inset

 debo destacar el pié de página, un componente adicional que no ha aparecido
 en imágenes anteriores al situarse siempre al final del contenido principal.
 En este caso al ser el contenido un panel que cabe en la vista sin necesidad
 de un 
\emph on
scroll
\emph default
, es visible.
 En este pie de página hay un link 'API', que conduce al endpoint del backend
 donde se encuentra la documentación del API REST.
 Esta documentación es autogenerada por Swagger.
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset

Debajo de 'Mi repositorio' en el menú de navegación se encuentra el desplegable
 '
\series bold
Administración
\series default
', en el que se agrupan secciones únicamente accesibles para usuarios con
 el rol de administrador y permiten llevar a cabo acciones o consultar informaci
ón sobre datos del sistema que no deberían ser accesibles para el usuario
 común.
 La primera sección que encontramos bajo el desplegable de administración
 es '
\series bold
Usuarios
\series default
':
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename figs/4-frontend/admin-usuarios.png
	width 100text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Sección-administración-de"

\end_inset

Sección administración de usuarios
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
Esta sección permite a un administrador acceder a la tabla de usuarios de
 la base de datos y realizar acciones sobre ella.
 Como se puede ver en la imagen, por comodidad en el desarrollo existen
 una serie de usuarios predefinidos que se generan cada vez que se arranca
 el servicio en caso de que no existan previamente.
 Los usuarios se muestran en una lista, un usuario por fila.
 Para cada usuario se pueden realizar una serie de acciones:
\end_layout

\begin_layout Itemize

\bar under
Editar
\bar default
: Abre un diálogo en el que hay un formulario con los datos del usuario.
 En el se permite modificar cualquiera de estos datos, así como habilitar
 o deshabilitar la cuenta.
 Una cuenta deshabilitada produce un error en la autenticación.
 
\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename figs/4-frontend/formulario-editar-usuario.png
	width 50text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Formulario editar usuario
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Itemize

\bar under
Restablecer contraseña
\bar default
: Permite crear una nueva contraseña para el usuario seleccionado.
\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename figs/4-frontend/formulario-resetear-contraseña.png
	width 40text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Formulario resetear contraseña
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Itemize

\bar under
Eliminar
\bar default
: Esta acción debería eliminar el usuario y borrar todas las composiciones
 asociadas a él, sin embargo por el momento se encuentra deshabilitada al
 no estar implementado el endpoint correspondiente en el backend.
\end_layout

\begin_layout Standard
Dentro del menú de administración también se encuentra la sección de 
\series bold
'Logs'
\series default
, un lugar en el que se hace un volcado de los logs guardados en base de
 datos.
 Por el momento, no todos los logs son publicados en la tabla destinada
 a dicho fin, sólo los más relevantes, a la espera de encontrar un método
 más adecuado para almacenarlos y mostrarlos por la interfaz.
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename figs/4-frontend/administracon-logs.png
	width 100text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Sección logs
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
Su diseño es muy simple, consiste únicamente en una lista con una línea
 de log por fila, ordenados de más a menos recientes.
 El color de cada fila variará según el tipo de log (info, warning, error...).
 Esta interfaz permite al desarrollador obtener la causa de un error de
 forma sencilla y rápida sin necesidad de acceder al fichero de logs del
 servidor.
 En un principio no me pareció la mejor idea guardar los logs de toda la
 aplicación en base de datos, sin embargo por sencillez se ha optado por
 guardar los más relevantes.
 Por este motivo, muchos de los errores no aparecerán en esta sección y
 sólo se podrán encontrar en los ficheros guardados en el servidor.
 Un punto pendiente para el futuro es decidir una forma mejor de implementar
 esta sección e incluir algún tipo de filtro, ya sea por fecha, tipo o contenido
 del mensaje.
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset

Por último tenemos el botón de '
\series bold
Cerrar sesión
\series default
', que no es más que otro enlace para navegar a la ruta '/auth/logout' al
 igual que pulsando sobre el usuario de la cabecera y seleccionando la opción
 'Logout' ya mencionada anteriormente.
\end_layout

\begin_layout Section
Descripción
\end_layout

\begin_layout Standard
En la introducción de este capítulo se ha descrito a grandes rasgos cómo
 ha ido evolucionando este módulo hasta el resultado que existe a día de
 escribir esta memoria, concluyendo en que se ha empleado Angular como framework
 de desarrollo y se ha partido de la plantilla 'ngx-admin' de 'Akveo'.
 A continuación, se va a profundizar algo más en él a nivel de código y
 de organización de archivos del proyecto:
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset

En cuanto a la jerarquía del arbol de ficheros, se va a evitar hablaro sobre
 los ficheros y directorios presentes en la raíz a excepción de la carpeta
 src, ya que el resto son elementos comunes a todos los proyectos desarrollados
 con NodeJS o Angular.
 En cuanto a la carpeta src, contiene todo el código fuente de la web.
 Está formada por los archivos de la figura 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Carpeta-src"
plural "false"
caps "false"
noprefix "false"

\end_inset

.
 Los más relevantes son:
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename figs/4-frontend/carpeta-src.png
	width 40text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Carpeta-src"

\end_inset

Carpeta src
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Itemize

\bar under
app
\bar default
: Contiene los componentes en los que están definidos la lógica y los datos
 de la aplicación.
 
\end_layout

\begin_layout Itemize

\bar under
assets
\bar default
: Contiene los adjuntos, archivos a los que se puede hacer referencia desde
 la web, tales como imágenes, documentos...
 Estos archivos son copiados cuando se ejecuta un 
\emph on
build
\emph default
 de la aplicación.
\end_layout

\begin_layout Itemize

\bar under
environments
\bar default
: Contiene opciones de configuración para los distintos entornos.
\end_layout

\begin_layout Itemize

\bar under
index.html
\bar default
: Archivo HTML principal mostrado cada vez que alguien visita la página.
 Padre de todos los demás.
 Durante la compilación, el CLI de Angular se encarga de añadir automáticamente
 todos los javascript, css por lo que no será necesario indicar manualmente.
\end_layout

\begin_layout Itemize

\bar under
main.ts
\bar default
: Punto de entrada a la aplicación.
 Compila la aplicación con el compilador 
\begin_inset CommandInset nomenclature
LatexCommand nomenclature
symbol "JIT"
description "Just In Time"
literal "false"

\end_inset

JIT
\begin_inset Foot
status open

\begin_layout Plain Layout
El compilador JIT (o just-in-time) convierte los archivos Angular HTML y
 TypeScript en JavaScript optimizado para lograr una mayor eficiencia
\end_layout

\end_inset

.
\end_layout

\begin_layout Standard
La carpeta 
\series bold
app
\series default
 es la fundamental del proyecto, donde se encuentra la mayor parte del trabajo.
 En ella se encuentran los siguientes archivos:
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename carpeta-src-app.PNG
	width 40text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Carpeta-src/app"

\end_inset

Carpeta src/app
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Itemize
Comenzando por la carpeta 
\series bold

\begin_inset Quotes eld
\end_inset

@core
\series default

\begin_inset Quotes erd
\end_inset

, esta consiste en un módulo que contiene la lógica de negocio de la aplicación.
 Sus archivos están organizados en dos subidrectorios (
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Carpeta-src/app/@core"
plural "false"
caps "false"
noprefix "false"

\end_inset

), la carpeta 
\begin_inset Quotes eld
\end_inset

data
\begin_inset Quotes erd
\end_inset

, en la que se han ido guardando las clases e interfaces correspondientes
 con el modelado de datos, y la carpeta 
\begin_inset Quotes eld
\end_inset

utils
\begin_inset Quotes erd
\end_inset

, donde se encuentran mayoritariamente clases con los decoradores 
\begin_inset Quotes eld
\end_inset

@Injectable()
\begin_inset Quotes erd
\end_inset

, empleados para ser inyectados en los módulos de los componentes y se encargan
 de realizar las llamadas al API
\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename figs/4-frontend/carpeta-core.png
	width 40text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Carpeta-src/app/@core"

\end_inset

Carpeta src/app/@core
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset

Por ejemplificar el tipo de contenido de esta carpeta, centrándonos en el
 caso de uso de consultar las partituras de un usuario nos encontraríamos
 dentro del directorio 
\begin_inset Quotes eld
\end_inset

utils
\begin_inset Quotes erd
\end_inset

 una clase que implemente los métodos necesarios para hacer estas consultas.
 Por convención, en Angular un servicio termina en 
\begin_inset Quotes eld
\end_inset

.service.ts
\begin_inset Quotes erd
\end_inset

, por lo tanto su nombre de archivo seria 
\begin_inset Quotes eld
\end_inset

sheets.service.ts
\begin_inset Quotes erd
\end_inset

.
 En él se definen métodos para obtener un listado de partituras con determinados
 filtros, obtener una partitura en concreto, descargar los documentos asociados
 a dicha partitura, reintentar...
 En el fragmento de código 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Archivo-sheets.service.ts"
plural "false"
caps "false"
noprefix "false"

\end_inset

 se representa una simplificación de este servicio.
\begin_inset listings
lstparams "language=Java,float=p,numbers=left,basicstyle={\ttfamily},breaklines=true,tabsize=4"
inline false
status open

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Archivo-sheets.service.ts"

\end_inset

Archivo sheets.service.ts
\end_layout

\end_inset

import {HttpClient} from '@angular/common/http'; 
\end_layout

\begin_layout Plain Layout

import {Injectable} from '@angular/core'; 
\end_layout

\begin_layout Plain Layout

import {environment} from 'environments/environment'; 
\end_layout

\begin_layout Plain Layout

import {Sheet, SheetPage} from '../data/sheet';
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

@Injectable() 
\end_layout

\begin_layout Plain Layout

export class SheetService {
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

    constructor(private httpClient: HttpClient) {
\end_layout

\begin_layout Plain Layout

    
\end_layout

\begin_layout Plain Layout

	}
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

	getSheet(id: number) {         
\end_layout

\begin_layout Plain Layout

		const urlRequest = `${environment.apiUrl}/api/sheets/${id}`;         
\end_layout

\begin_layout Plain Layout

		return this.httpClient.get<Sheet>(urlRequest);     
\end_layout

\begin_layout Plain Layout

	}
\end_layout

\begin_layout Plain Layout

}
\end_layout

\end_inset

Como se puede ver en él, se emplea un cliente HTTP para realizar una llamada
 al API utilizando el correspondiente endpoint, e indica en la línea 15
 que el resultado es un objeto de tipo Sheet.
 La declaración de esta interfaz está definida en la carpeta data, siendo
 algo similar al fragmento 
\begin_inset CommandInset ref
LatexCommand ref
reference "lis:Archivo-sheet.ts"
plural "false"
caps "false"
noprefix "false"

\end_inset

, adaptándose a la definición que devuelve este método documentado en el
 API.
\begin_inset Newline newline
\end_inset


\begin_inset listings
lstparams "language=Java,float=p,numbers=left,basicstyle={\ttfamily},breaklines=true,tabsize=4"
inline false
status open

\begin_layout Plain Layout

\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "lis:Archivo-sheet.ts"

\end_inset

Archivo sheet.ts
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

export interface Sheet {     
\end_layout

\begin_layout Plain Layout

	id: number;     
\end_layout

\begin_layout Plain Layout

	name: string;     
\end_layout

\begin_layout Plain Layout

	style: string;     
\end_layout

\begin_layout Plain Layout

	date: string;     
\end_layout

\begin_layout Plain Layout

	sheet: string;     
\end_layout

\begin_layout Plain Layout

	finished: boolean;     
\end_layout

\begin_layout Plain Layout

	specs: boolean;     
\end_layout

\begin_layout Plain Layout

	xml: boolean;     
\end_layout

\begin_layout Plain Layout

	pdf: boolean; 
\end_layout

\begin_layout Plain Layout

}
\end_layout

\end_inset


\end_layout

\begin_layout Itemize
El siguiente sería 
\begin_inset Quotes eld
\end_inset


\series bold
@theme
\series default

\begin_inset Quotes erd
\end_inset

.
 Este módulo contiene archivos y definiciones relacionadas con el estilo
 y la disposición de los elementos en pantalla, así como los componentes
 de la interfaz tales como cabecera, pie de página, menú de navegación...
 No va a ser analizada en profundidad ya que pertenece casi en su totalidad
 a la plantilla de origen.
 Lo único que se ha modificado en él on los componentes que han sido adaptados
 a la finalidad de este proyecto, por ejemplo al modificar la cabecera para
 incluir título, versión y usuario actual.
\end_layout

\begin_layout Itemize
En 
\begin_inset Quotes eld
\end_inset


\series bold
auth
\series default

\begin_inset Quotes erd
\end_inset

 se encuentran los componentes relacionados con la autenticación.
 Por defecto, la plantilla ngx-admin viene con sus componentes predeterminados
 dentro de la librería de nebular (login, register, logout, reset password).
 Aunque cuentan con funciones de personalización, no son lo suficientemente
 flexibles para según qué modificaciones, por lo tanto si se quiere ir más
 allá la solución que proporciona esta librería es crear tus propios componentes
 extendiendo los que ya existen.
 La carpeta 
\begin_inset Quotes eld
\end_inset

auth
\begin_inset Quotes erd
\end_inset

 no existía de origen en la plantilla, sino que se ha creado para meter
 en ella esos componentes extendidos que se vayan necesitando.
 En este caso por ejemplo, ha sido necesario crear un nuevo componente de
 registro para poder mapear las propiedades del usuario de la aplicación
 añadiendo nuevos campos al formulario de registro.
\end_layout

\begin_layout Itemize
En 
\begin_inset Quotes eld
\end_inset


\series bold
pages
\series default

\begin_inset Quotes erd
\end_inset

 están todos los módulos y componentes que se visualizan en la interfaz.
 En la imagen 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Carpeta-pages"
plural "false"
caps "false"
noprefix "false"

\end_inset

 se puede ver que se intenta guardar una correspondencia entre la jerarquía
 de carpetas y las rutas de la aplicación.
 Por ejemplo, la sección /pages/home se encuentra en el directorio 
\begin_inset Quotes eld
\end_inset

home
\begin_inset Quotes erd
\end_inset

 dentro del directorio 
\begin_inset Quotes eld
\end_inset

pages
\begin_inset Quotes erd
\end_inset

.
 Cada una de las carpetas que se encuentran dentro de 
\begin_inset Quotes eld
\end_inset

pages
\begin_inset Quotes erd
\end_inset

 constituye un módulo de Angular.
 Un módulo permite declarar sus propias dependencias con otros módulos,
 y servicios.
 De esta manera se puede independizar las relaciones de cada uno de ellos
 haciendo posible que, en el caso de un módulo más sencillo como puede ser
 el de 
\begin_inset Quotes eld
\end_inset

home
\begin_inset Quotes erd
\end_inset

, no requiera un tiempo de carga excesivo al tener que importar dependencias
 relativas a otro módulo como el de 
\begin_inset Quotes eld
\end_inset

repositorio
\begin_inset Quotes erd
\end_inset

 y que no tenga que utilizar en ningún momento.
\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename figs/4-frontend/carpeta-pages.png
	width 40text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Carpeta-pages"

\end_inset

Carpeta pages
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Itemize
Por último, en la carpeta 
\begin_inset Quotes eld
\end_inset


\series bold
commons
\series default

\begin_inset Quotes erd
\end_inset

 se han ido guardando aquellos componentes transversales a varios módulos
 y que por lo tanto no se han podido asignar a uno u otro.
 Un ejemplo de componente común es el formulario de usuario, que se emplea
 tanto en la sección de perfil donde el usuario puede ver los datos de su
 cuenta, como en administración al tratar de editar un usuario.
 Este componente se ha reutilizado en ambos sitios, sin embargo no pertenece
 ni a uno ni a otro.
 De esta manera, no es necesario en el módulo de administración, importar
 todo el módulo de perfil completo, cuando es sólo un componente el que
 va a ser utilizado.
 Además de por eficiencia, separar este componente permite reutilizarlo
 facilmente sin tener ningún acoplamiento con cualquiera de los otros módulos.
\end_layout

\end_body
\end_document
